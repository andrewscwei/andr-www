<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Data Structure Alignment: Alignment Class Members</title>
        <meta charset="utf-8">
        <meta name="description" content="Andrew Wei, codenamed mu, is a software engineer, experience designer and illustrator.">
        <meta name="keywords" content="andrew,wei,andr,mu,engineer,designer,illustrator">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <meta property="og:url">
        <meta property="og:image" content="/og-image-3c57fca1f2.png">
        <meta property="og:title" content="Data Structure Alignment: Alignment Class Members">
        <meta property="og:description" content="Andrew Wei, codenamed mu, is a software engineer, experience designer and illustrator.">
        <link rel="shortcut icon" href="/favicon.png">
        <link rel="manifest" href="/manifest.json">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-title" content="Data Structure Alignment: Alignment Class Members">
        <link href="/apple-touch-icon-180x180-precomposed-151af9722e.png" sizes="180x180" rel="apple-touch-icon">
        <link href="/apple-touch-icon-152x152-precomposed-4d4481414b.png" sizes="152x152" rel="apple-touch-icon">
        <link href="/apple-touch-icon-144x144-precomposed-c735943caf.png" sizes="144x144" rel="apple-touch-icon">
        <link href="/apple-touch-icon-120x120-precomposed-81dd7e0ad6.png" sizes="120x120" rel="apple-touch-icon">
        <link href="/apple-touch-icon-114x114-precomposed-1daf1d75d6.png" sizes="114x114" rel="apple-touch-icon">
        <link href="/apple-touch-icon-76x76-precomposed-f49e287ced.png" sizes="76x76" rel="apple-touch-icon">
        <link href="/apple-touch-icon-72x72-precomposed-a5412e18eb.png" sizes="72x72" rel="apple-touch-icon">
        <link href="/apple-touch-icon-60x60-precomposed-55aaa7669c.png" sizes="60x60" rel="apple-touch-icon">
        <link href="/apple-touch-icon-57x57-precomposed-e896f01ce1.png" sizes="57x57" rel="apple-touch-icon">
        <link href="/apple-touch-icon-precomposed-609906461e.png" rel="apple-touch-icon">
        <meta name="msapplication-config" content="/browserconfig.xml">
        <meta name="application-name" content="Data Structure Alignment: Alignment Class Members">
        <meta name="msapplication-tooltip" content="Get the latest updates!">
        <meta name="msapplication-window" content="width=1024;height=768">
        <meta name="msapplication-navbutton-color" content="#ff3300">
        <meta name="msapplication-starturl" content="/">
        <script type="text/javascript" src="https://unpkg.com/@webcomponents/webcomponentsjs@2.2.10/webcomponents-bundle.js"></script>
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-108117457-1"></script>
        <script>window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'UA-108117457-1');
        </script>
        <link rel="stylesheet" href="/assets/stylesheets/application-7fc252c149.css">
    </head>
    <body><page-home id="home" name="home"><a class="down triangle" is="x-a" type="button" href="/logs/" name="down-button" style="display:none;"></a>
            <div is="name-card" name="name-card">
                <section class="logo"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 70 70" style="enable-background:new 0 0 70 70;" xml:space="preserve" preserveAspectRatio="xMidYMid">
                        <circle class="dot-1" cx="5.3" cy="49.8" r="5.3"></circle>
                        <circle class="dot-2" cx="5.3" cy="35" r="5.3"></circle>
                        <circle class="dot-3" cx="5.3" cy="20.2" r="5.3"></circle>
                        <circle class="dot-4" cx="20.2" cy="20.2" r="5.3"></circle>
                        <circle class="dot-5" cx="35" cy="20.2" r="5.3"></circle>
                        <circle class="dot-6" cx="35" cy="35" r="5.3"></circle>
                        <circle class="dot-7" cx="35" cy="49.8" r="5.3"></circle>
                        <circle class="dot-8" cx="49.8" cy="49.8" r="5.3"></circle>
                        <circle class="dot-9" cx="64.7" cy="49.8" r="5.3"></circle>
                        <circle class="dot-10" cx="64.7" cy="35" r="5.3"></circle>
                        <circle class="dot-11" cx="64.7" cy="20.2" r="5.3"></circle>
                    </svg></section>
                <section class="name">
                    <h1 class="full-name">Andrew Wei</h1>
                </section>
                <section class="position"><span class="position" type="label">Engineer / Designer / Illustrator</span></section>
                <section class="connect"><a is="x-a" type="button" href="mailto:andrewscwei@gmail.com"><span type="icon" style="background-image: url(/assets/images/logs%2F439f2919-b36c-4403-837e-257d6bbde80c_email-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://github.com/andrewscwei"><span type="icon" style="background-image: url(/assets/images/logs%2F92b82402-ce51-49db-a8b2-d2c8924cdbe0_github-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://twitter.com/andrewscwei"><span type="icon" style="background-image: url(/assets/images/logs%2F719d8066-6750-4a08-afb7-a860a10482bc_twitter-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://calculator3.andr.mu"><span type="icon" style="background-image: url(/assets/images/logs%2Fa4f8b935-bf95-45ae-bf82-7fbee9b994be_calculator3-icon.svg?auto=compress,format)"></span></a><a class="inactive" is="x-a" type="button" href="https://www.variante.io"><span type="icon" style="background-image: url(/assets/images/logs%2F3781e233-b368-4800-bebb-17c5e47955d1_vaiante-icon.svg?auto=compress,format)"></span></a><a class="inactive" is="x-a" type="button" href="https://www.grubbb.co"><span type="icon" style="background-image: url(/assets/images/logs%2F698dcb27-4e5e-4f9c-8473-0e5bb46af2d1_grubbb-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://www.verb.studio"><span type="icon" style="background-image: url(/assets/images/logs%2F6bf8145f-5ea8-41d6-8cdd-d9c199a97806_verb-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://dice.andr.mu"><span type="icon" style="background-image: url(/assets/images/logs%2F6d5406b1-3ec0-4915-abdf-f39a8ee95801_dice-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://monitor.andr.mu"><span type="icon" style="background-image: url(/assets/images/logs%2F7021ac91-7a57-4815-90e7-90cf2011cdf7_monitoring-test-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://www.aristotl.io"><span type="icon" style="background-image: url(/assets/images/logs%2F0240039f-2372-4fa9-af5c-18880f192e4c_aristotl-icon.svg?auto=compress,format)"></span></a><a is="x-a" type="button" href="https://www.sybl.io"><span type="icon" style="background-image: url(/assets/images/logs%2F5e961282-d08e-433d-960b-1e114a2bbc12_sybl.svg?auto=compress,format)"></span></a></section>
            </div>
        </page-home>
        <main id="page"><page-cover id="cover" name="cover">
                <figure name="background" style="background-image:url(/assets/images/logs/3e41668398da27f76f40d3494bb35944bb1c3546_data-structure-alignment-cover.jpg?auto=compress,format)"></figure>
            </page-cover>
            <nav is="global-nav" id="global-nav" name="global-nav"><a class="logs" is="x-a" type="button" href="/logs/" name="grid-button"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 70 70" style="enable-background:new 0 0 70 70;" xml:space="preserve" preserveAspectRatio="xMidYMid">
                        <path class="tl" d="M30,33H3c-1.7,0-3-1.3-3-3V3c0-1.7,1.3-3,3-3h27c1.7,0,3,1.3,3,3v27C33,31.7,31.7,33,30,33L30,33z M6,27h21V6H6V27L6,27z"></path>
                        <path class="tr" d="M67,33H40c-1.7,0-3-1.3-3-3V3c0-1.7,1.3-3,3-3h27c1.7,0,3,1.3,3,3v27C70,31.7,68.7,33,67,33L67,33z M43,27h21V6H43V27    L43,27z"></path>
                        <path class="bl" d="M30,70H3c-1.7,0-3-1.3-3-3V40c0-1.7,1.3-3,3-3h27c1.7,0,3,1.3,3,3v27C33,68.7,31.7,70,30,70L30,70z M6,64h21V43H6V64L6,64    z"></path>
                        <path class="br" d="M67,70H40c-1.7,0-3-1.3-3-3V40c0-1.7,1.3-3,3-3h27c1.7,0,3,1.3,3,3v27C70,68.7,68.7,70,67,70L67,70z M43,64h21V43H43V64    L43,64z"></path>
                    </svg></a></nav><page-log id="log" name="page">
                <div id="inner-page">
                    <div name="header">
                        <div name="info">
                            <h1 name="title">Data Structure Alignment: Alignment Class Members</h1><span name="date" type="label">Mar 24 14</span>
                            <div name="tags"><a class="tag slug" is="x-a" type="button" href="/logs/tag/coding/"><span type="label">coding</span></a><a class="tag slug" is="x-a" type="button" href="/logs/tag/c/"><span type="label">c++</span></a></div>
                        </div>
                    </div>
                    <div name="contents">
                        <p>Suppose there are two C++ classes, A and B, with the following structures in a 64-bit system:</p>
                        <pre class=" line-numbers language-cpp"><code class=" language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> b1<span class="token punctuation">;</span>
    <span class="token keyword">double</span> x1<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b2<span class="token punctuation">;</span>
    <span class="token keyword">double</span> x2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">B</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">double</span> x1<span class="token punctuation">;</span>
    <span class="token keyword">double</span> x2<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b1<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
                        <p>Their members are identical, except their order of declaration is different. So what’s the deal here? If you do a <code>sizeof()</code> for both classes, class <code>A</code> will have a size of 32 (bytes) and class <code>B</code> will have a size of 24 (bytes). This is due to the compiler performing type/class alignment as it reads/writes these members to computer memory. The compiler will attempt to do this in chunks of the computer’s word size, i.e. in a 64-bit system that would be 8 bytes, whereas in a 32-bit system that would be 4 bytes. During this process the compiler will insert byte paddings in between members so they can fit in word chunks. This is what the classes look like after the compiler is done (again, this example refers to a 64-bit system where the word size is 8 bytes):</p>
                        <pre class=" line-numbers language-cpp"><code class=" language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> b1<span class="token punctuation">;</span>            <span class="token comment">// this is 1 byte</span>
    <span class="token keyword">char</span> padding1<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// since the next member is a double (8 bytes), compiler will add 7 bytes to fill the gap and fit the previous bool in a word chunk</span>
    <span class="token keyword">double</span> x1<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b2<span class="token punctuation">;</span>
    <span class="token keyword">char</span> padding2<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// same as above</span>
    <span class="token keyword">double</span> x2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">B</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">double</span> x1<span class="token punctuation">;</span>
    <span class="token keyword">double</span> x2<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b1<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b2<span class="token punctuation">;</span>
    <span class="token keyword">char</span> padding2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// adding 6 bytes to fill the gap</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
                        <p>In conclusion, the rule of thumb is to always order members from largest to smallest and group same types together. For more info about data structure alignment, visit this Wikipedia article: <a href="http://en.wikipedia.org/wiki/Data_structure_alignment">Data Structure Alignment</a>.</p>
                    </div>
                    <div name="footer"><a class="prev post" is="x-a" type="button" href="/logs/xcode-custom-key-bindings/"><span class="prev" type="icon"></span><span type="label">prev</span></a><button class="arrow" is="x-button" type="button" name="top-button"><span class="up" type="icon"></span></button><a class="next post" is="x-a" type="button" href="/logs/mac-single-user-mode/"><span class="next" type="icon"></span><span type="label">next</span></a></div>
                    <div name="related">
                        <div class="tags" name="tags"><button class="tag" is="x-button" type="button" disabled="disabled"><span type="label">related</span></button></div>
                        <div class="grid"><a type="button" is="log-entry" href="/logs/implementing-the-factorial-function-in-objective-c/" name="entry">
                                <div class="wrapper">
                                    <h2 class="title">Implementing the Factorial Function in Objective-C Using the Gamma Function</h2><span class="date" type="label">Apr 25 11</span><span class="number" type="label">0</span>
                                </div>
                            </a><a type="button" is="log-entry" href="/logs/establishing-communication-between-iphone-and-arduino/" name="entry">
                                <div class="wrapper">
                                    <h2 class="title">Establishing Communication between iPhone and Arduino Ethernet Shield</h2><span class="date" type="label">Jun 24 11</span><span class="number" type="label">2</span>
                                </div>
                            </a><a type="button" is="log-entry" href="/logs/google-compute-engine-setup-for-django-app-with-uwsgi/" name="entry">
                                <div class="wrapper">
                                    <h2 class="title">Google Compute Engine Setup for Django App with uWSGI and Nginx</h2><span class="date" type="label">Jun 01 15</span><span class="number" type="label">12</span>
                                </div>
                            </a></div>
                    </div>
                </div>
            </page-log>
        </main>
        <script src="/assets/javascripts/polyfills-4df15158e5.js"></script>
        <script src="/assets/javascripts/common-a589f09cab.js"></script>
        <script src="/assets/javascripts/application-a1f774b4b0.js"></script>
    </body>
</html>
